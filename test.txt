# fetchPage
curl -X POST http://localhost:9000/2015-03-31/functions/function/invocations \
  -H "Content-Type: application/json" \
  -d @test/events/fetchPage.json | jq

# parseDeals
curl -X POST http://localhost:9000/2015-03-31/functions/function/invocations \
  -H "Content-Type: application/json" \
  -d @test/events/parseDeals.json | jq

# saveDeals
curl -X POST http://localhost:9000/2015-03-31/functions/function/invocations \
  -H "Content-Type: application/json" \
  -d @test/events/saveDeals.json | jq


  aws iam create-role \
  --role-name GithubActionsDeployRole \
  --assume-role-policy-document '{
    "Version": "2012-10-17",
    "Statement": [{
      "Effect": "Allow",
      "Principal": {
        "Federated": "arn:aws:iam::443915510240:oidc-provider/token.actions.githubusercontent.com"
      },
      "Action": "sts:AssumeRoleWithWebIdentity",
      "Condition": {
        "StringEquals": {
          "token.actions.githubusercontent.com:aud": "sts.amazonaws.com"
        },
        "StringLike": {
          "token.actions.githubusercontent.com:sub": "repo:lintshy/deal-finder:ref:refs/heads/main"
        }
      }
    }]
  }'


  {
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "UpdateLambdaCode",
      "Effect": "Allow",
      "Action": [
        "lambda:UpdateFunctionCode",
        "lambda:UpdateFunctionConfiguration",
        "lambda:PublishVersion",
        "lambda:GetFunction",
        "lambda:GetFunctionConfiguration"
      ],
      "Resource": "arn:aws:lambda:us-east-1:443915510240:function:ScraperToolsLambda"
    },
    {
      "Sid": "WaitForUpdate",
      "Effect": "Allow",
      "Action": [
        "lambda:GetFunctionConfiguration"
      ],
      "Resource": "arn:aws:lambda:us-east-1:443915510240:function:ScraperToolsLambda"
    }
  ]
}

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "CloudWatchLogs",
      "Effect": "Allow",
      "Action": [
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:PutLogEvents"
      ],
      "Resource": "arn:aws:logs:us-east-1:443915510240:log-group:/aws/lambda/ScraperToolsLambda:*"
    },
    {
      "Sid": "DynamoDBDeals",
      "Effect": "Allow",
      "Action": [
        "dynamodb:BatchWriteItem",
        "dynamodb:PutItem",
        "dynamodb:GetItem",
        "dynamodb:Scan",
        "dynamodb:Query"
      ],
      "Resource": "arn:aws:dynamodb:us-east-1:443915510240:table/Deals"
    },
    {
      "Sid": "SSMConfig",
      "Effect": "Allow",
      "Action": [
        "ssm:GetParameter",
        "ssm:GetParametersByPath"
      ],
      "Resource": "arn:aws:ssm:us-east-1:443915510240:parameter/scraper/*"
    }
  ]
}

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "InvokeLambdaTools",
      "Effect": "Allow",
      "Action": "lambda:InvokeFunction",
      "Resource": "arn:aws:lambda:us-east-1:443915510240:function:ScraperToolsLambda"
    },
    {
      "Sid": "ReadAgentSchema",
      "Effect": "Allow",
      "Action": "s3:GetObject",
      "Resource": "arn:aws:s3:::your-bucket/scraper-agent/*"
    },
    {
      "Sid": "BedrockModelAccess",
      "Effect": "Allow",
      "Action": "bedrock:InvokeModel",
      "Resource": "arn:aws:bedrock:us-east-1::foundation-model/anthropic.claude-sonnet-4-5"
    }
  ]
}

{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Sid": "CloudWatchLogs",
      "Effect": "Allow",
      "Action": [
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:PutLogEvents"
      ],
      "Resource": "arn:aws:logs:us-east-1:443915510240:log-group:/aws/lambda/DailyScrapeTrigger:*"
    },
    {
      "Sid": "InvokeBedrockAgent",
      "Effect": "Allow",
      "Action": "bedrock:InvokeAgent",
      "Resource": "arn:aws:bedrock:us-east-1:443915510240:agent-alias/YOUR_AGENT_ID/YOUR_ALIAS_ID"
    }
  ]
}
```

---

## Full Picture
```
GitHub Actions
  └── assumes → GithubActionsDeployRole
        └── deploys code to → ScraperToolsLambda

EventBridge (daily cron)
  └── triggers → DailyScrapeTrigger Lambda
        └── assumes → EventBridgeTriggerRole
              └── invokes → Bedrock Agent
                    └── assumes → BedrockAgentRole
                          └── invokes → ScraperToolsLambda
                                └── assumes → ScraperLambdaExecutionRole
                                      └── reads/writes → DynamoDB Deals table